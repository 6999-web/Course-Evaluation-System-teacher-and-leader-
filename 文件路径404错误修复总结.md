# ğŸ”§ æ–‡ä»¶è·¯å¾„404é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ“‹ é—®é¢˜æè¿°

åœ¨ç‚¹å‡»"AIè‡ªåŠ¨è¯„åˆ†"æŒ‰é’®æ—¶å‡ºç°é”™è¯¯ï¼š
```
æ–‡ä»¶è§£æå¤±è´¥: [WinError 3] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„: 
'../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend/uploads/evaluation_submissions/teacher_001\tpl_8cb26a5d_teacher_001_20260204100031_37adfbc6d'
```

## ğŸ” é—®é¢˜åŸå› 

### æ ¹æœ¬åŸå› 
Windowsç³»ç»Ÿä¸Šçš„è·¯å¾„åˆ†éš”ç¬¦é—®é¢˜ï¼š
- **æ··åˆä½¿ç”¨**: ä»£ç ä¸­æ··åˆä½¿ç”¨äº†æ­£æ–œæ  `/` å’Œåæ–œæ  `\`
- **å­—ç¬¦ä¸²æ‹¼æ¥**: ä½¿ç”¨ f-string æ‹¼æ¥è·¯å¾„ï¼Œæ²¡æœ‰æ­£ç¡®å¤„ç†åˆ†éš”ç¬¦
- **è·¯å¾„ä¸è§„èŒƒ**: æ²¡æœ‰ä½¿ç”¨ `os.path.normpath()` è§„èŒƒåŒ–è·¯å¾„

### å…·ä½“é—®é¢˜
```python
# é”™è¯¯çš„æ–¹å¼
possible_paths = [
    file_path,
    f"../../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend/{file_path}",  # âŒ å­—ç¬¦ä¸²æ‹¼æ¥
    f"../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend/{file_path}",     # âŒ æ··åˆåˆ†éš”ç¬¦
]

# file_path å¯èƒ½æ˜¯: "uploads\evaluation_submissions\teacher_001\file.txt"
# æ‹¼æ¥åå˜æˆ: "../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend/uploads\evaluation_submissions\..."
# æ··åˆäº† / å’Œ \ï¼Œåœ¨Windowsä¸Šä¼šå‡ºé”™
```

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä½¿ç”¨ os.path.normpath() è§„èŒƒåŒ–è·¯å¾„
```python
# è§„èŒƒåŒ–æ–‡ä»¶è·¯å¾„ï¼ˆå¤„ç†Windowsåæ–œæ ï¼‰
file_path = os.path.normpath(file_path)
```

### 2. ä½¿ç”¨ os.path.join() æ‹¼æ¥è·¯å¾„
```python
# æ­£ç¡®çš„æ–¹å¼
base_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(__file__))))
possible_paths = [
    file_path,
    os.path.join(base_dir, "è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯", "backend", file_path),
    os.path.join(base_dir, "..", "è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯", "backend", file_path),
    os.path.normpath(os.path.join(os.path.dirname(__file__), "../../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend", file_path))
]
```

### 3. æ·»åŠ æ—¥å¿—è¾“å‡º
```python
for path in possible_paths:
    normalized_path = os.path.normpath(path)
    logger.info(f"å°è¯•è·¯å¾„: {normalized_path}")
    if os.path.exists(normalized_path):
        actual_file_path = normalized_path
        logger.info(f"æ‰¾åˆ°æ–‡ä»¶: {actual_file_path}")
        break
```

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

### scoring.py
ä¿®æ”¹äº†3ä¸ªåœ°æ–¹çš„è·¯å¾„å¤„ç†ï¼š

1. **EvaluationAssignmentTask è¯„åˆ†** (ç¬¬70-120è¡Œ)
2. **MaterialSubmission è¯„åˆ†** (ç¬¬210-230è¡Œ)
3. **æ‰¹é‡è¯„åˆ†** (ç¬¬360-400è¡Œ)

### å…³é”®æ”¹è¿›
```python
# ä¿®å¤å‰
possible_paths = [
    file_path,
    f"../../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend/{file_path}",
]

# ä¿®å¤å
file_path = os.path.normpath(file_path)
base_dir = os.path.dirname(os.path.dirname(os.path.dirname(os.path.dirname(__file__))))
possible_paths = [
    file_path,
    os.path.join(base_dir, "è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯", "backend", file_path),
    os.path.join(base_dir, "..", "è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯", "backend", file_path),
    os.path.normpath(os.path.join(os.path.dirname(__file__), "../../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend", file_path))
]

actual_file_path = None
for path in possible_paths:
    normalized_path = os.path.normpath(path)
    logger.info(f"å°è¯•è·¯å¾„: {normalized_path}")
    if os.path.exists(normalized_path):
        actual_file_path = normalized_path
        logger.info(f"æ‰¾åˆ°æ–‡ä»¶: {actual_file_path}")
        break
```

## ğŸ§ª æµ‹è¯•ç»“æœ

### è·¯å¾„è§„èŒƒåŒ–æµ‹è¯•
```
åŸå§‹: uploads/evaluation_submissions/teacher_001\tpl_xxx
è§„èŒƒ: uploads\evaluation_submissions\teacher_001\tpl_xxx

åŸå§‹: uploads\evaluation_submissions\teacher_001\tpl_xxx
è§„èŒƒ: uploads\evaluation_submissions\teacher_001\tpl_xxx

åŸå§‹: uploads/evaluation_submissions/teacher_001/tpl_xxx
è§„èŒƒ: uploads\evaluation_submissions\teacher_001\tpl_xxx
```

### æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
```
âœ… æ‰¾åˆ°æ•™å¸ˆç«¯ç›®å½•!
âœ… uploadsç›®å½•å­˜åœ¨
âœ… evaluation_submissions/teacher_001 å­˜åœ¨
   æ–‡ä»¶æ•°: 41
âœ… submissions/teacher_001 å­˜åœ¨
   æ–‡ä»¶æ•°: 78
```

## ğŸš€ åº”ç”¨ä¿®å¤

### æ­¥éª¤1: é‡å¯åç«¯æœåŠ¡

**é‡è¦**: å¿…é¡»é‡å¯åç«¯æ‰èƒ½åº”ç”¨ä»£ç æ›´æ”¹ï¼

```bash
# æ–¹æ³•1: å¦‚æœä½¿ç”¨PM2
pm2 restart evaluation-backend

# æ–¹æ³•2: æ‰‹åŠ¨é‡å¯
# 1. æ‰¾åˆ°å¹¶åœæ­¢Pythonè¿›ç¨‹
Get-Process | Where-Object {$_.ProcessName -eq "python"} | Stop-Process

# 2. é‡æ–°å¯åŠ¨
cd è¯„æ•™ç³»ç»Ÿæœ€ç»ˆç‰ˆ/è¯„æ•™ç³»ç»Ÿç®¡ç†ç«¯/backend_8fMBP/backend
python -m uvicorn app.main:app --reload --port 8001
```

### æ­¥éª¤2: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

```
1. æŒ‰ Ctrl + Shift + Delete
2. æˆ–å³é”®åˆ·æ–°æŒ‰é’® â†’ "æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"
```

### æ­¥éª¤3: æµ‹è¯•AIè¯„åˆ†

1. åˆ·æ–°æµè§ˆå™¨é¡µé¢ (F5)
2. è¿›å…¥"è€ƒè¯„ä»»åŠ¡"é¡µé¢
3. æ‰¾åˆ°"å·²æäº¤"çŠ¶æ€çš„ä»»åŠ¡
4. ç‚¹å‡»"AIè‡ªåŠ¨è¯„åˆ†"æŒ‰é’®
5. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è·¯å¾„ä¿¡æ¯

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰ âŒ
```
ç‚¹å‡»"AIè‡ªåŠ¨è¯„åˆ†"
  â†“
è°ƒç”¨ /api/scoring/score/task_xxx
  â†“
å°è¯•è·¯å¾„: ../../è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯/backend/uploads\evaluation_submissions\...
  â†“
è·¯å¾„æ ¼å¼é”™è¯¯ï¼ˆæ··åˆ / å’Œ \ï¼‰
  â†“
[WinError 3] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„
  â†“
è¯„åˆ†å¤±è´¥
```

### ä¿®å¤å âœ…
```
ç‚¹å‡»"AIè‡ªåŠ¨è¯„åˆ†"
  â†“
è°ƒç”¨ /api/scoring/score/task_xxx
  â†“
è§„èŒƒåŒ–è·¯å¾„: os.path.normpath(file_path)
  â†“
å°è¯•è·¯å¾„1: C:\...\è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯\backend\uploads\evaluation_submissions\...
  â†“
æ‰¾åˆ°æ–‡ä»¶ï¼
  â†“
è§£ææ–‡ä»¶å†…å®¹
  â†“
è°ƒç”¨DeepSeek API
  â†“
è¯„åˆ†æˆåŠŸï¼
```

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### Windowsè·¯å¾„å¤„ç†æœ€ä½³å®è·µ

1. **å§‹ç»ˆä½¿ç”¨ os.path.normpath()**
   ```python
   path = os.path.normpath(path)  # è§„èŒƒåŒ–ä¸ºç³»ç»Ÿè·¯å¾„æ ¼å¼
   ```

2. **å§‹ç»ˆä½¿ç”¨ os.path.join()**
   ```python
   path = os.path.join(base, "dir", "file.txt")  # è‡ªåŠ¨ä½¿ç”¨æ­£ç¡®åˆ†éš”ç¬¦
   ```

3. **é¿å…å­—ç¬¦ä¸²æ‹¼æ¥**
   ```python
   # âŒ é”™è¯¯
   path = f"{base}/{dir}/{file}"
   
   # âœ… æ­£ç¡®
   path = os.path.join(base, dir, file)
   ```

4. **æ·»åŠ æ—¥å¿—è¾“å‡º**
   ```python
   logger.info(f"å°è¯•è·¯å¾„: {normalized_path}")
   logger.info(f"æ–‡ä»¶å­˜åœ¨: {os.path.exists(normalized_path)}")
   ```

### è·¨å¹³å°å…¼å®¹æ€§

ä¿®å¤åçš„ä»£ç åŒæ—¶æ”¯æŒï¼š
- âœ… Windows (åæ–œæ  `\`)
- âœ… Linux/Mac (æ­£æ–œæ  `/`)
- âœ… æ··åˆè·¯å¾„æ ¼å¼

## ğŸ” è°ƒè¯•æ–¹æ³•

### æŸ¥çœ‹åç«¯æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f logs/app.log

# æˆ–åœ¨Windows PowerShellä¸­
Get-Content logs/app.log -Wait -Tail 50
```

### æ—¥å¿—è¾“å‡ºç¤ºä¾‹
```
INFO: å°è¯•è·¯å¾„: C:\Users\...\è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯\backend\uploads\evaluation_submissions\teacher_001\file.txt
INFO: æ‰¾åˆ°æ–‡ä»¶: C:\Users\...\è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯\backend\uploads\evaluation_submissions\teacher_001\file.txt
INFO: å¼€å§‹è§£ææ–‡ä»¶: C:\Users\...\è¯„æ•™ç³»ç»Ÿæ•™å¸ˆç«¯\backend\uploads\evaluation_submissions\teacher_001\file.txt
INFO: å¼€å§‹è¯„åˆ†: task_xxx
```

## ğŸ“ å¸¸è§é—®é¢˜

### Q: é‡å¯åç«¯åè¿˜æ˜¯æŠ¥é”™ï¼Ÿ
**A**: 
1. ç¡®è®¤ä»£ç å·²ä¿å­˜
2. ç¡®è®¤é‡å¯çš„æ˜¯æ­£ç¡®çš„è¿›ç¨‹
3. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è·¯å¾„ä¿¡æ¯
4. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### Q: æ—¥å¿—ä¸­çœ‹ä¸åˆ°"å°è¯•è·¯å¾„"ä¿¡æ¯ï¼Ÿ
**A**: 
1. ç¡®è®¤åç«¯å·²é‡å¯
2. ç¡®è®¤æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºINFO
3. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ä½ç½®

### Q: æ–‡ä»¶ç¡®å®å­˜åœ¨ä½†è¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Ÿ
**A**: 
1. æ£€æŸ¥æ–‡ä»¶æƒé™
2. æ£€æŸ¥è·¯å¾„ä¸­æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦
3. ä½¿ç”¨ç»å¯¹è·¯å¾„æµ‹è¯•

### Q: å¦‚ä½•éªŒè¯ä¿®å¤æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ
**A**: 
1. è¿è¡Œ `python test_path_fix.py`
2. æŸ¥çœ‹åç«¯æ—¥å¿—
3. åœ¨å‰ç«¯æµ‹è¯•AIè¯„åˆ†

## ğŸ¯ ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
- `è¯„æ•™ç³»ç»Ÿæœ€ç»ˆç‰ˆ/è¯„æ•™ç³»ç»Ÿç®¡ç†ç«¯/backend_8fMBP/backend/app/routes/scoring.py`

### æµ‹è¯•æ–‡ä»¶
- `test_path_fix.py` - è·¯å¾„å¤„ç†æµ‹è¯•è„šæœ¬

### æ–‡æ¡£æ–‡ä»¶
- `æ–‡ä»¶è·¯å¾„404é”™è¯¯ä¿®å¤æ€»ç»“.md` (æœ¬æ–‡æ¡£)
- `AIè¯„åˆ†404é”™è¯¯ä¿®å¤è¯´æ˜.md` - ä¹‹å‰çš„ä¿®å¤æ–‡æ¡£

## ğŸ‰ æ€»ç»“

é€šè¿‡æ­£ç¡®ä½¿ç”¨ `os.path.normpath()` å’Œ `os.path.join()`ï¼ŒæˆåŠŸè§£å†³äº†Windowsç³»ç»Ÿä¸Šçš„æ–‡ä»¶è·¯å¾„é—®é¢˜ã€‚

**å…³é”®æˆå°±**:
- ğŸ”§ ä¿®å¤äº†è·¯å¾„åˆ†éš”ç¬¦æ··åˆé—®é¢˜
- ğŸš€ æ”¯æŒè·¨å¹³å°è·¯å¾„å¤„ç†
- ğŸ’¯ æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- ğŸ“š å®Œå–„äº†è°ƒè¯•æ–¹æ³•

**ç³»ç»ŸçŠ¶æ€**: âš ï¸ éœ€è¦é‡å¯åç«¯  
**ä¿®å¤çŠ¶æ€**: âœ… ä»£ç å·²ä¿®å¤  
**ä¸‹ä¸€æ­¥**: é‡å¯åç«¯æœåŠ¡

---

*ä¿®å¤æ—¶é—´: 2026-02-04*  
*ä¿®å¤äººå‘˜: Kiro AI Assistant*  
*çŠ¶æ€: å·²å®Œæˆï¼Œå¾…é‡å¯åç«¯éªŒè¯*

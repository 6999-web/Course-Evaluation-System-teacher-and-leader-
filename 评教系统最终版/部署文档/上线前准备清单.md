# 评教系统上线前准备清单

本文档列出了系统上线前需要完成的所有准备工作。请按照清单逐项检查和完成。

## 1. 数据库迁移检查清单

### 1.1 数据库初始化

- [ ] 数据库已创建
- [ ] 所有表已创建成功
- [ ] 表结构与设计文档一致
- [ ] 主键和外键约束已设置
- [ ] 索引已创建

**验证命令**：

```bash
# 检查表是否创建
python scripts/check_db.py

# 输出应该显示所有表已创建
# Tables created:
# - scoring_templates
# - scoring_records
# - scoring_appeals
# - review_records
# - bonus_items
# - scoring_logs
# - material_submissions (extended)
# - evaluation_assignment_tasks (extended)
```

### 1.2 默认数据导入

- [ ] 5 类文件的评分模板已导入
- [ ] 系统配置已导入
- [ ] 用户角色已导入
- [ ] 默认管理员账户已创建

**验证命令**：

```bash
# 检查模板是否导入
python -c "from app.models import ScoringTemplate; print(ScoringTemplate.query.count())"

# 输出应该显示 5 个模板
# 5
```

### 1.3 数据库备份

- [ ] 初始数据库已备份
- [ ] 备份文件已验证可恢复
- [ ] 备份文件已存储在安全位置

**备份命令**：

```bash
# 备份数据库
cp /opt/evaluation-system/evaluation.db /opt/evaluation-system/backups/evaluation_initial.db

# 验证备份
ls -lh /opt/evaluation-system/backups/evaluation_initial.db
```

---

## 2. API 密钥配置检查清单

### 2.1 Deepseek API 密钥

- [ ] API 密钥已获取
- [ ] API 密钥已配置到 .env 文件
- [ ] API 密钥已验证有效
- [ ] API 调用配额已确认充足

**验证命令**：

```bash
# 测试 API 连接
python scripts/test_api.py

# 输出应该显示：
# Testing Deepseek API connection...
# API connection successful!
# Model: deepseek-chat
# Available tokens: 1000000
```

### 2.2 API 配置参数

- [ ] API URL 已正确配置
- [ ] 模型名称已正确配置（deepseek-chat）
- [ ] Temperature 已设置为 0.1
- [ ] 超时时间已设置为 30 秒
- [ ] 重试次数已设置为 3 次

**配置文件**：

```bash
# 检查 .env 文件
grep DEEPSEEK .env

# 输出应该显示：
# DEEPSEEK_API_KEY=sk-...
# DEEPSEEK_API_URL=https://api.deepseek.com/v1/chat/completions
# DEEPSEEK_MODEL=deepseek-chat
```

### 2.3 API 速率限制

- [ ] 速率限制已配置
- [ ] 批量评分延迟已设置
- [ ] 错误重试机制已启用

---

## 3. 系统配置检查清单

### 3.1 环境变量

- [ ] APP_ENV 已设置为 production
- [ ] APP_DEBUG 已设置为 false
- [ ] APP_SECRET_KEY 已设置为强密码
- [ ] CORS 源已正确配置

**验证命令**：

```bash
# 检查环境变量
grep "^APP_" .env

# 输出应该显示：
# APP_ENV=production
# APP_DEBUG=false
# APP_SECRET_KEY=...
```

### 3.2 文件存储

- [ ] 上传目录已创建
- [ ] 上传目录权限已设置（755）
- [ ] 最大文件大小已配置（50MB）
- [ ] 文件加密已启用

**验证命令**：

```bash
# 检查上传目录
ls -la /opt/evaluation-system/uploads

# 输出应该显示：
# drwxr-xr-x ... uploads
```

### 3.3 日志配置

- [ ] 日志目录已创建
- [ ] 日志级别已设置为 INFO
- [ ] 日志文件轮转已配置
- [ ] 日志保留期已设置

**验证命令**：

```bash
# 检查日志目录
ls -la /opt/evaluation-system/logs

# 检查日志文件
tail -20 /opt/evaluation-system/logs/app.log
```

### 3.4 试运行模式

- [ ] 试运行模式已启用（TRIAL_RUN_MODE=true）
- [ ] 试运行模式下的自动复核已配置
- [ ] 差异报告生成已配置

---

## 4. 前端构建检查清单

### 4.1 前端依赖

- [ ] npm 依赖已安装
- [ ] 依赖版本已锁定（package-lock.json）
- [ ] 没有安全漏洞（npm audit）

**验证命令**：

```bash
# 检查依赖
cd frontend && npm list

# 检查安全漏洞
npm audit

# 输出应该显示：
# 0 vulnerabilities
```

### 4.2 前端构建

- [ ] 前端已成功构建
- [ ] 构建输出文件已生成
- [ ] 构建大小在可接受范围内

**验证命令**：

```bash
# 检查构建输出
ls -lh frontend/dist/

# 输出应该显示：
# -rw-r--r-- ... index.html
# drwxr-xr-x ... js
# drwxr-xr-x ... css
```

### 4.3 前端配置

- [ ] API 基础 URL 已正确配置
- [ ] 环境已设置为 production
- [ ] 源映射已禁用（减小文件大小）

---

## 5. 后端服务检查清单

### 5.1 依赖安装

- [ ] Python 依赖已安装
- [ ] 依赖版本已锁定（requirements.txt）
- [ ] 虚拟环境已创建

**验证命令**：

```bash
# 检查依赖
pip list

# 检查虚拟环境
which python
```

### 5.2 服务启动

- [ ] 后端服务已启动
- [ ] 服务监听正确的端口（8000）
- [ ] 服务进程已运行

**验证命令**：

```bash
# 检查服务状态
sudo systemctl status evaluation-system

# 检查监听端口
netstat -tlnp | grep 8000

# 输出应该显示：
# tcp 0 0 127.0.0.1:8000 0.0.0.0:* LISTEN
```

### 5.3 API 健康检查

- [ ] API 健康检查端点可访问
- [ ] 数据库连接正常
- [ ] 所有必需的服务都已启动

**验证命令**：

```bash
# 检查 API 健康
curl -s http://localhost:8000/api/health | jq .

# 输出应该显示：
# {
#   "status": "healthy",
#   "timestamp": "2024-01-01T00:00:00Z",
#   "version": "2.0.0"
# }
```

---

## 6. Web 服务器配置检查清单

### 6.1 Nginx 配置

- [ ] Nginx 配置文件已创建
- [ ] SSL 证书已安装
- [ ] 反向代理已配置
- [ ] 静态文件服务已配置

**验证命令**：

```bash
# 检查 Nginx 配置
sudo nginx -t

# 输出应该显示：
# nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
# nginx: configuration file /etc/nginx/nginx.conf test is successful
```

### 6.2 SSL 证书

- [ ] SSL 证书已安装
- [ ] 证书有效期已确认
- [ ] 证书链已完整
- [ ] HTTPS 重定向已配置

**验证命令**：

```bash
# 检查证书有效期
openssl x509 -in /etc/ssl/certs/yourdomain.com.crt -noout -dates

# 输出应该显示：
# notBefore=...
# notAfter=...
```

### 6.3 安全头

- [ ] Strict-Transport-Security 已配置
- [ ] X-Content-Type-Options 已配置
- [ ] X-Frame-Options 已配置
- [ ] Content-Security-Policy 已配置

---

## 7. 安全检查清单

### 7.1 访问控制

- [ ] 管理员账户已创建
- [ ] 默认账户已删除或禁用
- [ ] 密码策略已配置
- [ ] 两因素认证已启用（可选）

**验证命令**：

```bash
# 检查用户账户
python -c "from app.models import User; print(User.query.all())"
```

### 7.2 数据加密

- [ ] 文件加密已启用
- [ ] 数据库连接已加密
- [ ] API 通信已加密（HTTPS）
- [ ] 敏感数据已加密存储

### 7.3 防火墙规则

- [ ] 只允许必需的端口（80、443）
- [ ] SSH 访问已限制
- [ ] 数据库访问已限制
- [ ] API 访问已限制

**验证命令**：

```bash
# 检查防火墙规则
sudo ufw status

# 输出应该显示：
# Status: active
# To                         Action      From
# --                         ------      ----
# 22/tcp                     ALLOW       Anywhere
# 80/tcp                     ALLOW       Anywhere
# 443/tcp                    ALLOW       Anywhere
```

### 7.4 日志和审计

- [ ] 访问日志已启用
- [ ] 错误日志已启用
- [ ] 审计日志已启用
- [ ] 日志保留期已设置

---

## 8. 性能测试检查清单

### 8.1 单个文件评分

- [ ] 单个文件评分时间 < 10 秒
- [ ] 评分结果准确
- [ ] 错误处理正确

**测试命令**：

```bash
# 运行性能测试
python scripts/performance_test.py --test single_file

# 输出应该显示：
# Single file scoring test:
# Average time: 5.2 seconds
# Success rate: 100%
```

### 8.2 批量评分

- [ ] 100 个文件评分时间 < 10 分钟
- [ ] 批量评分成功率 > 99%
- [ ] 内存使用在可接受范围内

**测试命令**：

```bash
# 运行批量评分测试
python scripts/performance_test.py --test batch_scoring --count 100

# 输出应该显示：
# Batch scoring test (100 files):
# Total time: 8 minutes 30 seconds
# Success rate: 99.5%
# Average memory: 512 MB
```

### 8.3 并发访问

- [ ] 系统支持 100 个并发用户
- [ ] 响应时间在可接受范围内
- [ ] 没有内存泄漏

**测试命令**：

```bash
# 运行并发测试
python scripts/load_test.py --concurrent 100 --duration 300

# 输出应该显示：
# Load test results:
# Concurrent users: 100
# Average response time: 500 ms
# Error rate: 0%
```

---

## 9. 功能测试检查清单

### 9.1 完整流程测试

- [ ] 管理员创建任务
- [ ] 教师上传文件
- [ ] 系统自动评分
- [ ] 教师查看结果
- [ ] 教师提交异议
- [ ] 管理员复核
- [ ] 教师确认结果
- [ ] 管理员公示结果

**测试步骤**：

```bash
# 运行完整流程测试
python scripts/e2e_test.py

# 输出应该显示：
# End-to-end test results:
# ✓ Admin creates task
# ✓ Teacher uploads file
# ✓ System scores file
# ✓ Teacher views result
# ✓ Teacher submits appeal
# ✓ Admin reviews appeal
# ✓ Teacher confirms result
# ✓ Admin publishes result
# All tests passed!
```

### 9.2 异常处理测试

- [ ] 文件格式错误处理
- [ ] API 调用失败处理
- [ ] 网络中断处理
- [ ] 数据库错误处理

### 9.3 边界值测试

- [ ] 最大文件大小（50MB）
- [ ] 最小文件大小（1 字节）
- [ ] 最大并发用户数
- [ ] 最大批量评分数量

---

## 10. 文档检查清单

### 10.1 用户文档

- [ ] 管理端操作手册已完成
- [ ] 教师端操作手册已完成
- [ ] 常见问题已列出
- [ ] 文档已审核

### 10.2 部署文档

- [ ] 部署指南已完成
- [ ] 快速部署指南已完成
- [ ] 故障排查指南已完成
- [ ] 文档已审核

### 10.3 API 文档

- [ ] API 端点已文档化
- [ ] 请求/响应格式已说明
- [ ] 错误代码已列出
- [ ] 示例已提供

---

## 11. 备份和恢复检查清单

### 11.1 备份策略

- [ ] 备份脚本已创建
- [ ] 备份计划已配置
- [ ] 备份存储位置已确认
- [ ] 备份保留期已设置

**验证命令**：

```bash
# 检查备份脚本
ls -la /opt/evaluation-system/scripts/backup.sh

# 检查 crontab
crontab -l | grep backup
```

### 11.2 恢复测试

- [ ] 数据库恢复已测试
- [ ] 文件恢复已测试
- [ ] 恢复时间已记录
- [ ] 恢复成功率已验证

**测试命令**：

```bash
# 运行恢复测试
python scripts/recovery_test.py

# 输出应该显示：
# Recovery test results:
# ✓ Database backup created
# ✓ Database restored successfully
# ✓ Data integrity verified
# Recovery time: 2 minutes 30 seconds
```

---

## 12. 监控和告警检查清单

### 12.1 监控配置

- [ ] 日志监控已配置
- [ ] 性能监控已配置
- [ ] 错误监控已配置
- [ ] 可用性监控已配置

### 12.2 告警规则

- [ ] CPU 使用率告警已配置
- [ ] 内存使用率告警已配置
- [ ] 磁盘空间告警已配置
- [ ] API 错误率告警已配置
- [ ] 数据库连接告警已配置

### 12.3 告警通知

- [ ] 邮件通知已配置
- [ ] 短信通知已配置（可选）
- [ ] 钉钉/企业微信通知已配置（可选）
- [ ] 告警接收人已配置

---

## 13. 用户培训检查清单

### 13.1 管理员培训

- [ ] 管理员已接受培训
- [ ] 管理员已理解系统功能
- [ ] 管理员已掌握常见操作
- [ ] 管理员已了解故障排查方法

### 13.2 教师培训

- [ ] 教师已接受培训
- [ ] 教师已理解上传流程
- [ ] 教师已了解评分标准
- [ ] 教师已知道如何提交异议

### 13.3 IT 支持培训

- [ ] IT 人员已接受培训
- [ ] IT 人员已掌握部署流程
- [ ] IT 人员已了解故障排查方法
- [ ] IT 人员已知道如何进行备份和恢复

---

## 14. 最终检查清单

### 14.1 系统就绪

- [ ] 所有功能已测试
- [ ] 所有文档已完成
- [ ] 所有人员已培训
- [ ] 所有备份已完成

### 14.2 上线前最后检查

- [ ] 系统性能满足要求
- [ ] 系统安全性满足要求
- [ ] 系统可用性满足要求
- [ ] 系统可维护性满足要求

### 14.3 上线批准

- [ ] 项目经理批准
- [ ] 技术负责人批准
- [ ] 学校领导批准
- [ ] 所有利益相关者同意

---

## 上线前最后 24 小时检查清单

### 检查项目

- [ ] 系统运行正常
- [ ] 所有服务已启动
- [ ] 数据库已备份
- [ ] 日志已清理
- [ ] 监控已启用
- [ ] 告警已配置
- [ ] 支持团队已就位
- [ ] 应急预案已准备

### 上线时间

- [ ] 上线时间已确定
- [ ] 上线窗口已预留
- [ ] 用户已通知
- [ ] 支持团队已准备

### 上线后检查

- [ ] 系统可访问
- [ ] 所有功能正常
- [ ] 没有错误日志
- [ ] 用户反馈正常

---

## 签字确认

| 项目 | 负责人 | 签字 | 日期 |
|------|--------|------|------|
| 数据库迁移 | | | |
| API 配置 | | | |
| 系统配置 | | | |
| 前端构建 | | | |
| 后端服务 | | | |
| Web 服务器 | | | |
| 安全检查 | | | |
| 性能测试 | | | |
| 功能测试 | | | |
| 文档完成 | | | |
| 备份恢复 | | | |
| 监控告警 | | | |
| 用户培训 | | | |
| 最终检查 | | | |
| 项目经理 | | | |
| 技术负责人 | | | |
| 学校领导 | | | |

---

**文档版本**：1.0  
**最后更新**：2024年1月  
**适用系统版本**：评教系统 v2.0+
